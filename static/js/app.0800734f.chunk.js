(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{211:function(e,a,t){e.exports={header:"JobList_header__23tFt",headerTitle:"JobList_headerTitle__21D__",headerLink:"JobList_headerLink__2zepi",headerLinkIcon:"JobList_headerLinkIcon__XdfBB",controlContainer:"JobList_controlContainer__3Yzj_",controlRight:"JobList_controlRight__38lfB"}},212:function(e,a,t){e.exports={list:"FormErrorBox_list__3BejY"}},213:function(e,a,t){e.exports={headerTitle:"ParameterFields_headerTitle__IBF76"}},214:function(e,a,t){e.exports={formButtonContainer:"JobAddForm_formButtonContainer__1MLSp",saveButton:"JobAddForm_saveButton__RfxZ9"}},215:function(e,a,t){e.exports={formButtonContainer:"JobEditForm_formButtonContainer__2b6Fi",deleteButton:"JobEditForm_deleteButton__VQxBE",saveButton:"JobEditForm_saveButton__278Ab"}},222:function(e,a,t){e.exports={wrapper:"JobDetails_wrapper__1-YkO",title:"JobDetails_title__1Cht7",details:"JobDetails_details__2HITJ"}},223:function(e,a,t){e.exports={pageHeader:"JobEdit_pageHeader__3Fywp",pageHeaderButton:"JobEdit_pageHeaderButton__29yjJ",pageHeaderTitle:"JobEdit_pageHeaderTitle__jZrIG",card:"JobEdit_card__2QqEg",cardHeader:"JobEdit_cardHeader__Mv_cj",cardHeaderTitle:"JobEdit_cardHeaderTitle__29Y64",cardHeaderInfo:"JobEdit_cardHeaderInfo__3VWZt",cardHeaderLink:"JobEdit_cardHeaderLink__2frj7",jobDetails:"JobEdit_jobDetails__194v-"}},224:function(e,a,t){e.exports={pageHeader:"JobView_pageHeader__3d3IR",pageHeaderButton:"JobView_pageHeaderButton__2VF9Z",pageHeaderTitle:"JobView_pageHeaderTitle__3wHyg",card:"JobView_card__3LlD0",cardHeader:"JobView_cardHeader__3v0pX",cardHeaderTitle:"JobView_cardHeaderTitle__tPEnV",cardHeaderInfo:"JobView_cardHeaderInfo__j1GsD",cardHeaderLink:"JobView_cardHeaderLink__86M36",jobDetails:"JobView_jobDetails__3cu4z"}},225:function(e,a,t){e.exports={pageHeader:"JobAdd_pageHeader__2NZzc",pageHeaderButton:"JobAdd_pageHeaderButton__Xg_R9",pageHeaderTitle:"JobAdd_pageHeaderTitle__1RMl0",card:"JobAdd_card__1HH6H",cardHeader:"JobAdd_cardHeader__1D3sS",cardHeaderTitle:"JobAdd_cardHeaderTitle__2TG9a",cardHeaderInfo:"JobAdd_cardHeaderInfo__vq_Y1",cardHeaderLink:"JobAdd_cardHeaderLink__2CzPt"}},226:function(e,a,t){e.exports={noticeBoxWrapper:"AuthWall_noticeBoxWrapper__1ums5"}},227:function(e,a,t){e.exports={wrapper:"PageWrapper_wrapper__t-CJy"}},228:function(e,a,t){},229:function(e){e.exports=JSON.parse('{"Not authorized":"","You don\'t have access to the Job Scheduler. Contact a system administrator to request access.":"","Choose from preset times":"","Delete job":"","Something went wrong whilst creating your job":"","CRON Expression":"","Delay":"","Delay in seconds ({{ lowerbound }} - {{ upperbound }})":"","Name":"","Job type":"","No options available":"","Parameters":"","Save":"","Cancel":"","Job details":"","Created {{ createdFromNow }}.":"","Last run {{ lastRunFromNow }}.":"","Last run status: {{ translatedStatus }}.":"","Actions":"","Delete":"","Edit":"","Job name":"","Type":"","Schedule":"","Next run":"","Status":"","On/off":"","No jobs to display":"","Not scheduled":"","Run manually":"","{{ delay }} seconds after last run":"","View":"","Every hour":"","Every day at midnight":"","Every day at 3 am":"","Every day at noon":"","Every week":"","Choose a preset time/interval":"","Insert preset":"","Are you sure you want to delete this job?":"","Are you sure you want to discard this form?":"","Discard":"","Are you sure you want to run this job?":"","Run":"","Back to all jobs":"","New Job":"","Configuration":"","About job configuration":"","Job: {{ name }}":"","Scheduled jobs":"","Filter jobs":"","Include system jobs in list":"","New job":"","System job: {{ name }}":"","Data value":"","Completeness":"","Completeness target":"","Org unit target":"","Event":"","Enrollment":"","Validation result":"","Completed":"","Disabled":"","Done":"","Failed":"","Not started":"","Running":"","Scheduled":"","Stopped":"","Analytics table":"","Continuous analytics table":"","Credentials expiry alert":"","Data integrity":"","Dataset notification":"","Data statistics":"","Data synchronization":"","Event programs data sync":"","File resource clean up":"","Metadata synchronization":"","Monitoring":"","Predictor":"","Program notifications":"","Push analysis":"","Remove expired reserved values":"","Resource table":"","Send scheduled message":"","Tracker programs data sync":"","Validation results notification":"","Disable inactive users":"","A CRON expression is required":"","Please enter a valid CRON expression":""}')},234:function(e,a,t){"use strict";t.r(a);var r={};t.r(r),t.d(r,"useAllJobs",(function(){return h})),t.d(r,"useAllParameterOptions",(function(){return g})),t.d(r,"useAllJobTypes",(function(){return _})),t.d(r,"useRefetchJobs",(function(){return y})),t.d(r,"useJobFilter",(function(){return v})),t.d(r,"useShowSystemJobs",(function(){return f})),t.d(r,"useJobListJobs",(function(){return T})),t.d(r,"useJob",(function(){return j})),t.d(r,"useJobType",(function(){return N})),t.d(r,"useJobTypeParameters",(function(){return C})),t.d(r,"useParameterOptions",(function(){return x}));var n=t(1),s=t.n(n),o=t(188),l=t(216),c=t(189),i=t(13);var d=Object(n.createContext)({jobs:{},jobTypes:{},parameterOptions:{},refetchJobs:()=>{throw new Error("Store context needs a valid provider")}});const u={jobs:{resource:"jobConfigurations",params:{fields:"*",paging:!1}}},m={jobTypes:{resource:"jobConfigurations/jobTypes",params:{fields:"*",paging:!1}}},p={skipTableTypes:{resource:"analytics/tableTypes"},validationRuleGroups:{resource:"validationRuleGroups",params:{paging:!1}},pushAnalysis:{resource:"pushAnalysis",params:{paging:!1}},predictors:{resource:"predictors",params:{paging:!1}},predictorGroups:{resource:"predictorGroups",params:{paging:!1}}},{node:b}=c.a;var E=({children:e})=>{const a=Object(n.useState)(""),t=Object(n.useState)(!1),r=Object(i.e)(u),l=Object(i.e)(m),c=Object(i.e)(p);if(r.loading||l.loading||c.loading)return s.a.createElement(o.p,null,s.a.createElement(o.e,null,s.a.createElement(o.g,null)));const b=r.error||l.error||c.error;if(b)throw b;const{jobConfigurations:E}=r.data.jobs,{jobTypes:h}=l.data.jobTypes,{skipTableTypes:g,validationRuleGroups:{validationRuleGroups:_},pushAnalysis:{pushAnalysis:y},predictors:{predictors:v},predictorGroups:{predictorGroups:f}}=c.data,T={skipTableTypes:g,validationRuleGroups:_,pushAnalysis:y,predictors:v,predictorGroups:f};return s.a.createElement(d.Provider,{value:{jobs:E,jobTypes:h,parameterOptions:T,refetchJobs:r.refetch,jobFilter:a,showSystemJobs:t}},e)};const h=()=>Object(n.useContext)(d).jobs,g=()=>Object(n.useContext)(d).parameterOptions,_=()=>Object(n.useContext)(d).jobTypes,y=()=>Object(n.useContext)(d).refetchJobs,v=()=>Object(n.useContext)(d).jobFilter,f=()=>Object(n.useContext)(d).showSystemJobs,T=()=>{const[e]=v(),[a]=f();return h().filter(a=>a.name.toLowerCase().includes(e.toLowerCase())).filter(e=>!!a||e.configurable)},j=e=>h().find(a=>a.id===e),N=e=>_().find(a=>a.jobType===e),C=e=>{const a=N(e);return"jobParameters"in a?a.jobParameters:[]},x=e=>g()[e];var S=t(8),O=t.n(S),A=t(201);var J=Object(A.a)();var R={DATA_VALUE:O.a.t("Data value"),COMPLETENESS:O.a.t("Completeness"),COMPLETENESS_TARGET:O.a.t("Completeness target"),ORG_UNIT_TARGET:O.a.t("Org unit target"),EVENT:O.a.t("Event"),ENROLLMENT:O.a.t("Enrollment"),VALIDATION_RESULT:O.a.t("Validation result")};var D={ANALYTICS_TABLE:O.a.t("Analytics table"),CONTINUOUS_ANALYTICS_TABLE:O.a.t("Continuous analytics table"),CREDENTIALS_EXPIRY_ALERT:O.a.t("Credentials expiry alert"),DATA_INTEGRITY:O.a.t("Data integrity"),DATA_SET_NOTIFICATION:O.a.t("Dataset notification"),DATA_STATISTICS:O.a.t("Data statistics"),DATA_SYNC:O.a.t("Data synchronization"),EVENT_PROGRAMS_DATA_SYNC:O.a.t("Event programs data sync"),FILE_RESOURCE_CLEANUP:O.a.t("File resource clean up"),META_DATA_SYNC:O.a.t("Metadata synchronization"),MONITORING:O.a.t("Monitoring"),PREDICTOR:O.a.t("Predictor"),PROGRAM_NOTIFICATIONS:O.a.t("Program notifications"),PUSH_ANALYSIS:O.a.t("Push analysis"),REMOVE_EXPIRED_RESERVED_VALUES:O.a.t("Remove expired reserved values"),RESOURCE_TABLE:O.a.t("Resource table"),SEND_SCHEDULED_MESSAGE:O.a.t("Send scheduled message"),TRACKER_PROGRAMS_DATA_SYNC:O.a.t("Tracker programs data sync"),VALIDATION_RESULTS_NOTIFICATION:O.a.t("Validation results notification"),DISABLE_INACTIVE_USERS:O.a.t("Disable inactive users")};var I={COMPLETED:O.a.t("Completed"),DISABLED:O.a.t("Disabled"),DONE:O.a.t("Done"),FAILED:O.a.t("Failed"),NOT_STARTED:O.a.t("Not started"),RUNNING:O.a.t("Running"),SCHEDULED:O.a.t("Scheduled"),STOPPED:O.a.t("Stopped")};const H={resource:"jobConfigurations",id:({id:e})=>e,type:"update",partial:!0,data:({enabled:e})=>({enabled:e})},{bool:w,string:F}=c.a;var k=({id:e,checked:a,disabled:t})=>{const[n,{loading:l}]=Object(i.d)(H),c=r.useRefetchJobs(),d=!a;return s.a.createElement(o.D,{name:"toggle-job-".concat(e),disabled:t||l,checked:a,onChange:()=>{n({id:e,enabled:d}).then(()=>c())}})};const{string:L}=c.a;var P=({id:e})=>s.a.createElement(o.q,{dense:!0,onClick:()=>J.push("/edit/".concat(e)),label:O.a.t("Edit")});const{string:B}=c.a;var M=({id:e})=>s.a.createElement(o.q,{dense:!0,onClick:()=>J.push("/view/".concat(e)),label:O.a.t("View")});const V=[{label:O.a.t("Every hour"),value:"0 0 * ? * *"},{label:O.a.t("Every day at midnight"),value:"0 0 1 ? * *"},{label:O.a.t("Every day at 3 am"),value:"0 0 3 ? * *"},{label:O.a.t("Every day at noon"),value:"0 0 12 ? * MON-FRI"},{label:O.a.t("Every week"),value:"0 0 3 ? * MON"}],{func:G}=c.a;var U=({setCron:e,hideModal:a})=>{const[t,r]=Object(n.useState)("");return s.a.createElement(o.r,{open:!0,small:!0,onClose:a},s.a.createElement(o.u,null,O.a.t("Choose a preset time/interval")),s.a.createElement(o.t,null,V.map(e=>s.a.createElement(o.y,Object.assign({},e,{checked:t===e.value,key:e.value,onChange:({value:e})=>r(e)})))),s.a.createElement(o.s,null,s.a.createElement(o.c,{end:!0},s.a.createElement(o.b,{secondary:!0,onClick:a,name:"hide-modal"},O.a.t("Cancel")),s.a.createElement(o.b,{primary:!0,name:"insert-preset",disabled:!t,onClick:()=>{a(),e(t)}},O.a.t("Insert preset")))))};const z={resource:"jobConfigurations",id:({id:e})=>e,type:"delete"},{func:W,string:Y}=c.a;var q=({id:e,hideModal:a,onSuccess:t})=>{const[r]=Object(i.d)(z);return s.a.createElement(o.r,{open:!0,small:!0,onClose:a},s.a.createElement(o.t,null,O.a.t("Are you sure you want to delete this job?")),s.a.createElement(o.s,null,s.a.createElement(o.c,{end:!0},s.a.createElement(o.b,{name:"hide-modal",secondary:!0,onClick:a},O.a.t("Cancel")),s.a.createElement(o.b,{name:"delete-job-".concat(e),destructive:!0,onClick:()=>{r({id:e}).then(()=>{a(),t()})}},O.a.t("Delete")))))};const{func:X}=c.a;var Z=({hideModal:e})=>s.a.createElement(o.r,{open:!0,small:!0,onClose:e},s.a.createElement(o.t,null,O.a.t("Are you sure you want to discard this form?")),s.a.createElement(o.s,null,s.a.createElement(o.c,{end:!0},s.a.createElement(o.b,{name:"cancel-discard-form",secondary:!0,onClick:e},O.a.t("Cancel")),s.a.createElement(o.b,{name:"discard-form",destructive:!0,onClick:()=>{e(),J.push("/")}},O.a.t("Discard")))));const{func:K,string:Q}=c.a;var $=({id:e,hideModal:a})=>{const t=Object(i.c)(),n={jobs:{resource:"jobConfigurations/".concat(e,"/execute")}},l=r.useRefetchJobs();return s.a.createElement(o.r,{open:!0,small:!0,onClose:a},s.a.createElement(o.t,null,O.a.t("Are you sure you want to run this job?")),s.a.createElement(o.s,null,s.a.createElement(o.c,{end:!0},s.a.createElement(o.b,{name:"hide-modal",secondary:!0,onClick:a},O.a.t("Cancel")),s.a.createElement(o.b,{name:"run-job-".concat(e),primary:!0,onClick:()=>{t.query(n).then(()=>{a(),l()})}},O.a.t("Run")))))};const{string:ee}=c.a;var ae=({id:e})=>{const{enabled:a}=r.useJob(e),[t,l]=Object(n.useState)(!1);return s.a.createElement(s.a.Fragment,null,s.a.createElement(o.q,{dense:!0,onClick:()=>{l(!0)},disabled:!a,label:O.a.t("Run manually")}),t&&s.a.createElement($,{id:e,hideModal:()=>l(!1)}))};const{string:te}=c.a;var re=({id:e})=>{const[a,t]=Object(n.useState)(!1),l=r.useRefetchJobs();return s.a.createElement(s.a.Fragment,null,s.a.createElement(o.q,{dense:!0,destructive:!0,onClick:()=>{t(!0)},label:O.a.t("Delete")}),a&&s.a.createElement(q,{id:e,hideModal:()=>t(!1),onSuccess:l}))};const ne=({id:e,configurable:a})=>s.a.createElement(o.i,{small:!0,component:s.a.createElement(o.k,null,a?s.a.createElement(P,{id:e}):s.a.createElement(M,{id:e}),a&&s.a.createElement(ae,{id:e}),a&&s.a.createElement(re,{id:e}))},O.a.t("Actions"));ne.defaultProps={configurable:!1};const{string:se,bool:oe}=c.a;var le=ne;const{string:ce}=c.a;var ie=({status:e})=>{switch(e){case"STOPPED":case"DISABLED":return s.a.createElement(o.M,null,I[e]);case"RUNNING":case"NOT_STARTED":case"SCHEDULED":return s.a.createElement(o.M,{neutral:!0},I[e]);case"FAILED":return s.a.createElement(o.M,{negative:!0},I[e]);case"DONE":return s.a.createElement(o.M,{positive:!0},I[e]);default:return null}},de=t(27),ue=t.n(de);const me=({nextExecutionTime:e,enabled:a})=>{if(!a||!e)return"-";const t=ue()(Date.now()),r=ue.a.utc(e);return r.isSameOrBefore(t,"minute")?O.a.t("Not scheduled"):t.to(r)},{bool:pe,string:be}=c.a;me.propTypes={enabled:pe.isRequired,nextExecutionTime:be};var Ee=me,he=t(209),ge=t.n(he);const _e=["MON","TUE","WED","THU","FRI","SAT","SUN"],ye=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],ve=(e,a,t)=>e>=a&&e<=t,fe=e=>"*"===e,Te=e=>"?"===e,je=(e,a,t)=>fe(e)||ve(e,a,t)||((e,a,t)=>{const r=e.split("-");return!(!r||2!==r.length)&&(ve(r[0],a,t)&&ve(r[1],a,t)&&r[0]<=r[1])})(e,a,t)||((e,a,t)=>{const r=e.split("/");return!(!r||2!==r.length)&&((fe(r[0])||ve(r[0],a,t))&&ve(r[1],a,t))})(e,a,t),Ne=e=>je(e,1,12)||(e=>{const a=e.split("-"),[t,r]=a.map(e=>ye.indexOf(e));return-1!==t&&void 0===r||-1!==t&&-1!==r&&t<=r})(e),Ce=e=>je(e,1,7)||(e=>{const a=e.split("-"),[t,r]=a.map(e=>_e.indexOf(e));return-1!==t&&void 0===r||-1!==t&&-1!==r&&t<=r})(e)||Te(e);var xe=e=>{if(!e)return!1;const a=e.trim().split(" ");return!!(e=>e&&6===e.length)(a)&&(t=a[0],je(t,0,59)&&(e=>je(e,0,59))(a[1])&&(e=>je(e,0,23))(a[2])&&(e=>je(e,0,31)||Te(e))(a[3])&&Ne(a[4])&&Ce(a[5]));var t};var Se=e=>"string"===typeof e&&e.length>0?xe(e)?void 0:O.a.t("Please enter a valid CRON expression"):O.a.t("A CRON expression is required");var Oe=e=>{const a=O.a.language||"en";return e&&xe(e)?ge.a.toString(e,{locale:a}):""};const Ae=({cronExpression:e,schedulingType:a,delay:t})=>{switch(a){case"CRON":return Oe(e);case"FIXED_DELAY":return O.a.t("{{ delay }} seconds after last run",{delay:t});default:return"-"}},{string:Je,number:Re}=c.a;Ae.propTypes={schedulingType:Je.isRequired,cronExpression:Je,delay:Re};var De=Ae;const{shape:Ie,string:He,bool:we,number:Fe}=c.a;var ke=({job:{id:e,displayName:a,jobType:t,cronExpression:r,delay:n,jobStatus:l,nextExecutionTime:c,schedulingType:i,enabled:d,configurable:u}})=>s.a.createElement(o.K,null,s.a.createElement(o.H,null,a),s.a.createElement(o.H,null,D[t]),s.a.createElement(o.H,null,s.a.createElement(De,{cronExpression:r,delay:n,schedulingType:i})),s.a.createElement(o.H,null,s.a.createElement(Ee,{nextExecutionTime:c,enabled:d})),s.a.createElement(o.H,null,s.a.createElement(ie,{status:l})),s.a.createElement(o.H,null,s.a.createElement(k,{id:e,checked:d,disabled:!u})),s.a.createElement(o.H,null,s.a.createElement(le,{id:e,configurable:u})));const{object:Le,arrayOf:Pe}=c.a;var Be=({jobs:e})=>s.a.createElement(o.F,null,s.a.createElement(o.J,null,s.a.createElement(o.L,null,s.a.createElement(o.I,null,O.a.t("Job name")),s.a.createElement(o.I,null,O.a.t("Type")),s.a.createElement(o.I,null,O.a.t("Schedule")),s.a.createElement(o.I,null,O.a.t("Next run")),s.a.createElement(o.I,null,O.a.t("Status")),s.a.createElement(o.I,null,O.a.t("On/off")),s.a.createElement(o.I,null))),s.a.createElement(o.G,null,0===e.length?s.a.createElement(o.K,null,s.a.createElement(o.H,null,O.a.t("No jobs to display"))):e.map(e=>s.a.createElement(ke,{key:e.id,job:e})))),Me=t(211),Ve=t.n(Me);const{bool:Ge,object:Ue,string:ze,arrayOf:We,func:Ye}=c.a;var qe=({jobs:e,showSystemJobs:a,setShowSystemJobs:t,jobFilter:r,setJobFilter:n})=>s.a.createElement(s.a.Fragment,null,s.a.createElement("header",{className:Ve.a.header},s.a.createElement("h1",{className:Ve.a.headerTitle},O.a.t("Scheduled jobs")),s.a.createElement("a",{href:"https://docs.dhis2.org/en/use/user-guides/dhis-core-version-236/maintaining-the-system/scheduling.html",className:Ve.a.headerLink,target:"_blank",rel:"noopener noreferrer"},s.a.createElement("span",{className:Ve.a.headerLinkIcon},s.a.createElement(o.l,null)),O.a.t("About job configuration"))),s.a.createElement(o.d,null,s.a.createElement("div",{className:Ve.a.controlContainer},s.a.createElement(o.m,{dataTest:"job-filter-input",placeholder:O.a.t("Filter jobs"),onChange:({value:e})=>{n(e)},value:r}),s.a.createElement("div",{className:Ve.a.controlRight},s.a.createElement(o.f,{dataTest:"job-toggle-checkbox",checked:a,label:O.a.t("Include system jobs in list"),onChange:({checked:e})=>{t(e)}}),s.a.createElement(o.b,{dataTest:"new-job-button",onClick:()=>{J.push("/add")}},O.a.t("New job")))),s.a.createElement(Be,{jobs:e})));var Xe=()=>{const[e,a]=r.useJobFilter(),[t,n]=r.useShowSystemJobs(),o=r.useJobListJobs();return s.a.createElement(qe,{jobs:o,showSystemJobs:t,setShowSystemJobs:n,jobFilter:e,setJobFilter:a})};const Ze=({setCron:e,small:a})=>{const[t,r]=Object(n.useState)(!1);return s.a.createElement(s.a.Fragment,null,s.a.createElement(o.b,{onClick:()=>r(!0),small:a},O.a.t("Choose from preset times")),t&&s.a.createElement(U,{hideModal:()=>r(!1),setCron:e}))};Ze.defaultProps={small:!1};const{func:Ke,bool:Qe}=c.a;var $e=Ze;const{string:ea,func:aa}=c.a;var ta=({id:e,onSuccess:a})=>{const[t,r]=Object(n.useState)(!1);return s.a.createElement(s.a.Fragment,null,s.a.createElement(o.b,{destructive:!0,onClick:()=>r(!0)},O.a.t("Delete job")),t&&s.a.createElement(q,{id:e,hideModal:()=>r(!1),onSuccess:a}))};const ra=({shouldConfirm:e,children:a,small:t,className:r})=>{const[l,c]=Object(n.useState)(!1),i=e?()=>c(!0):()=>J.push("/");return s.a.createElement(s.a.Fragment,null,s.a.createElement(o.b,{onClick:i,small:t,className:r},a),l&&s.a.createElement(Z,{hideModal:()=>c(!1)}))};ra.defaultProps={className:"",shouldConfirm:!1,small:!1};const{string:na,bool:sa}=c.a;var oa=ra;const{FORM_ERROR:la}=o.j;var ca=e=>{const{details:{response:a}}=e,t={},r=[];return a.errorReports&&a.errorReports.length&&a.errorReports.forEach(e=>{e.errorProperty?t[e.errorProperty]=e.message:r.push(e.message)}),r.length>0&&(t[la]=r),t};const ia={resource:"jobConfigurations",type:"create",data:({job:e})=>e};var da=()=>{const{refetchJobs:e}=Object(n.useContext)(d),a=Object(i.c)();return[t=>a.mutate(ia,{variables:{job:t}}).then(()=>{J.push("/"),e()}).catch(e=>{if("access"===e.type)return ca(e);throw e})]};const ua={resource:"jobConfigurations",type:"update",id:({id:e})=>e,data:({job:e})=>e};var ma=({id:e})=>{const{refetchJobs:a}=Object(n.useContext)(d),t=Object(i.c)();return[r=>t.mutate(ua,{variables:{job:r,id:e}}).then(()=>{J.push("/"),a()}).catch(e=>{if("access"===e.type)return ca(e);throw e})]},pa=t(212),ba=t.n(pa);const{array:Ea}=c.a;var ha=({submitError:e})=>e.length>0?s.a.createElement(o.x,{error:!0,title:O.a.t("Something went wrong whilst creating your job")},s.a.createElement("ul",{className:ba.a.list},e.map(e=>s.a.createElement("li",{key:e},e)))):null;const{Field:ga}=o.z,_a=Object(o.N)(o.R,o.P);var ya=()=>s.a.createElement(ga,{name:"name",component:o.o,validate:_a,label:O.a.t("Name"),type:"text",required:!0});const{Field:va}=o.z,fa=Object(o.N)(o.R,o.P);var Ta=()=>{const e=r.useAllJobTypes().map(({jobType:e})=>({value:e,label:D[e]}));return s.a.createElement(va,{name:"jobType",validate:fa,component:o.B,options:e,label:O.a.t("Job type"),required:!0})};const ja=e=>"number"===typeof e?e.toString():e,{Field:Na}=o.z,{string:Ca}=c.a;var xa=({label:e,name:a,parameterName:t})=>{const n=r.useParameterOptions(t);if(0===n.length)return s.a.createElement(o.v,{disabled:!0,helpText:O.a.t("No options available"),label:e});const l=n.map(e=>({value:e,label:R[e]||e}));return s.a.createElement(Na,{name:a,component:o.w,options:l,label:e})};const{Field:Sa}=o.z,{string:Oa}=c.a;var Aa=({label:e,name:a,parameterName:t})=>{const n=r.useParameterOptions(t);if(0===n.length)return s.a.createElement(o.v,{disabled:!0,helpText:O.a.t("No options available"),label:e});const l=n.map(({id:e,displayName:a})=>({value:e,label:a}));return s.a.createElement(Sa,{name:a,component:o.w,options:l,label:e})},Ja=t(213),Ra=t.n(Ja);const{Field:Da}=o.z,{string:Ia}=c.a;var Ha=({jobType:e})=>{const a=r.useJobTypeParameters(e);if(0===a.length)return null;const t=a.map(({fieldName:e,name:a,klass:t})=>{const r={label:e,name:"".concat("jobParameters",".").concat(a)};let n=null;if("skipTableTypes"===a)return s.a.createElement(o.a,{marginTop:"16px",key:a},s.a.createElement(xa,Object.assign({},r,{parameterName:a})));switch(t){case"java.lang.String":n=s.a.createElement(Da,Object.assign({},r,{component:o.o,type:"text"}));break;case"java.lang.Boolean":n=s.a.createElement(Da,Object.assign({},r,{component:o.E,type:"checkbox"}));break;case"java.lang.Integer":n=s.a.createElement(Da,Object.assign({},r,{component:o.o,format:ja,type:"number"}));break;case"java.util.List":n=s.a.createElement(Aa,Object.assign({},r,{parameterName:a}))}return s.a.createElement(o.a,{marginTop:"16px",key:a},n)});return s.a.createElement(s.a.Fragment,null,s.a.createElement("header",null,s.a.createElement("h4",{className:Ra.a.headerTitle},O.a.t("Parameters"))),t)};const{Field:wa,useFormState:Fa,useForm:ka}=o.z,La=Se;var Pa=()=>{const e=ka(),{values:a}=Fa({subscription:{values:!0}}),t=a.cronExpression,r=Oe(t);return s.a.createElement(s.a.Fragment,null,s.a.createElement(wa,{component:o.o,name:"cronExpression",validate:La,label:O.a.t("CRON Expression"),type:"text",helpText:r,required:!0}),s.a.createElement(o.a,{marginTop:"8px"},s.a.createElement($e,{setCron:a=>e.change("cronExpression",a),small:!0})))};const{Field:Ba}=o.z,Ma=Object(o.N)(o.Q,o.P,Object(o.O)(1,86400));var Va=()=>s.a.createElement(Ba,{component:o.o,name:"delay",validate:Ma,label:O.a.t("Delay"),type:"number",format:ja,helpText:O.a.t("Delay in seconds ({{ lowerbound }} - {{ upperbound }})",{lowerbound:1,upperbound:86400}),required:!0});const{string:Ga}=c.a;var Ua=({jobType:e})=>{switch(r.useJobType(e).schedulingType){case"CRON":return s.a.createElement(Pa,null);case"FIXED_DELAY":return s.a.createElement(Va,null);default:return null}};const za="jobType";var Wa=t(214),Ya=t.n(Wa);const{useForm:qa}=o.z,Xa=({handleSubmit:e,pristine:a,submitting:t,submitError:r,hasSubmitErrors:l,values:c,setIsPristine:i})=>{const{subscribe:d}=qa();Object(n.useEffect)(()=>d(({pristine:e})=>i(e),{pristine:!0}));const u=c[za],m=t?s.a.createElement(o.g,{small:!0}):null;return s.a.createElement("form",{onSubmit:e},s.a.createElement(o.a,{maxWidth:"600px"},s.a.createElement(ya,null)),s.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},s.a.createElement(Ta,null)),u&&s.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},s.a.createElement(Ua,{jobType:u})),u&&s.a.createElement(o.a,{marginTop:"32px",maxWidth:"400px"},s.a.createElement(Ha,{jobType:u})),l&&s.a.createElement(o.a,{marginTop:"32px",maxWidth:"600px"},s.a.createElement(ha,{submitError:r})),s.a.createElement("div",{className:Ya.a.formButtonContainer},s.a.createElement(o.b,{primary:!0,type:"submit",disabled:a||t,icon:m,className:Ya.a.saveButton},O.a.t("Save")),s.a.createElement(oa,{shouldConfirm:!a},O.a.t("Cancel"))))},{func:Za,bool:Ka,object:Qa,array:$a}=c.a;Xa.defaultProps={submitError:[]};var et=Xa;const{Form:at}=o.z,{func:tt}=c.a;var rt=({setIsPristine:e})=>{const[a]=da();return s.a.createElement(at,{onSubmit:a,component:et,setIsPristine:e,destroyOnUnregister:!0})},nt=t(215),st=t.n(nt);const{useForm:ot}=o.z,lt=({id:e,refetchJobs:a,handleSubmit:t,pristine:r,submitting:l,submitError:c,hasSubmitErrors:i,values:d,setIsPristine:u})=>{const{subscribe:m}=ot();Object(n.useEffect)(()=>m(({pristine:e})=>u(e),{pristine:!0}));const p=d[za],b=l?s.a.createElement(o.g,{small:!0}):null;return s.a.createElement("form",{onSubmit:t},s.a.createElement(o.a,{maxWidth:"600px"},s.a.createElement(ya,null)),s.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},s.a.createElement(Ta,null)),p&&s.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},s.a.createElement(Ua,{jobType:p})),p&&s.a.createElement(o.a,{marginTop:"32px",maxWidth:"400px"},s.a.createElement(Ha,{jobType:p})),i&&s.a.createElement(o.a,{marginTop:"32px",maxWidth:"600px"},s.a.createElement(ha,{submitError:c})),s.a.createElement("div",{className:st.a.formButtonContainer},s.a.createElement(o.b,{primary:!0,type:"submit",disabled:r||l,icon:b,className:st.a.saveButton},O.a.t("Save")),s.a.createElement(oa,{shouldConfirm:!r},O.a.t("Cancel")),s.a.createElement("span",{className:st.a.deleteButton},s.a.createElement(ta,{id:e,onSuccess:()=>{J.push("/"),a()}}))))},{func:ct,bool:it,object:dt,array:ut,string:mt}=c.a;lt.defaultProps={submitError:[]};var pt=lt;const{Form:bt}=o.z,Et=["cronExpression","delay","jobParameters","jobType","name","schedulingType"],{func:ht}=c.a;var gt=({setIsPristine:e})=>{const{id:a}=Object(l.c)(),[t]=ma({id:a}),n=r.useRefetchJobs(),o=r.useJob(a),c=Et.reduce((e,a)=>(e[a]=o[a],e),{});return s.a.createElement(bt,{onSubmit:t,component:pt,setIsPristine:e,initialValues:c,id:a,refetchJobs:n,destroyOnUnregister:!0})},_t=t(222),yt=t.n(_t);const{string:vt}=c.a;var ft=({created:e,lastExecutedStatus:a,lastExecuted:t})=>{const r=Date.now(),n=ue()(e).from(r),o=I[a],l=t?ue()(t).from(r):"";return s.a.createElement("div",{className:yt.a.wrapper},s.a.createElement("h4",{className:yt.a.title},O.a.t("Job details")),s.a.createElement("div",{className:yt.a.details},s.a.createElement("div",null,O.a.t("Created {{ createdFromNow }}.",{createdFromNow:n})),l&&s.a.createElement("div",null,O.a.t("Last run {{ lastRunFromNow }}.",{lastRunFromNow:l})),o&&s.a.createElement("div",null,O.a.t("Last run status: {{ translatedStatus }}.",{translatedStatus:o,nsSeparator:">"}))))},Tt=t(223),jt=t.n(Tt);const{bool:Nt,func:Ct,string:xt}=c.a;var St=({isPristine:e,setIsPristine:a,name:t,created:r,lastExecutedStatus:n,lastExecuted:l})=>s.a.createElement(s.a.Fragment,null,s.a.createElement("header",{className:jt.a.pageHeader},s.a.createElement(oa,{shouldConfirm:!e,className:jt.a.pageHeaderButton,small:!0},O.a.t("Back to all jobs")),s.a.createElement("h2",{className:jt.a.pageHeaderTitle},O.a.t("Job: {{ name }}",{name:t,nsSeparator:">"}))),s.a.createElement(o.d,{className:jt.a.card},s.a.createElement("header",{className:jt.a.cardHeader},s.a.createElement("h3",{className:jt.a.cardHeaderTitle},O.a.t("Configuration")),s.a.createElement("a",{href:"https://docs.dhis2.org/en/use/user-guides/dhis-core-version-236/maintaining-the-system/scheduling.html",className:jt.a.cardHeaderLink,target:"_blank",rel:"noopener noreferrer"},s.a.createElement("span",{className:jt.a.cardHeaderInfo},s.a.createElement(o.l,null)),O.a.t("About job configuration"))),s.a.createElement("div",{className:jt.a.jobDetails},s.a.createElement(ft,{created:r,lastExecutedStatus:n,lastExecuted:l})),s.a.createElement(gt,{setIsPristine:a})));var Ot=()=>{const[e,a]=Object(n.useState)(!0),{id:t}=Object(l.c)(),o=r.useJob(t);return s.a.createElement(St,{isPristine:e,setIsPristine:a,name:o.name,created:o.created,lastExecutedStatus:o.lastExecutedStatus,lastExecuted:o.lastExecuted})},At=t(224),Jt=t.n(At);var Rt=()=>{const{id:e}=Object(l.c)(),{name:a,created:t,lastExecutedStatus:n,lastExecuted:c,jobType:i,cronExpression:d}=r.useJob(e);return s.a.createElement(s.a.Fragment,null,s.a.createElement("header",{className:Jt.a.pageHeader},s.a.createElement(oa,{className:Jt.a.pageHeaderButton,small:!0},O.a.t("Back to all jobs")),s.a.createElement("h2",{className:Jt.a.pageHeaderTitle},O.a.t("System job: {{ name }}",{name:a,nsSeparator:">"}))),s.a.createElement(o.d,{className:Jt.a.card},s.a.createElement("header",{className:Jt.a.cardHeader},s.a.createElement("h3",{className:Jt.a.cardHeaderTitle},O.a.t("Configuration")),s.a.createElement("a",{href:"https://docs.dhis2.org/en/use/user-guides/dhis-core-version-236/maintaining-the-system/scheduling.html",className:Jt.a.cardHeaderLink,target:"_blank",rel:"noopener noreferrer"},s.a.createElement("span",{className:Jt.a.cardHeaderInfo},s.a.createElement(o.l,null)),O.a.t("About job configuration"))),s.a.createElement("div",{className:Jt.a.jobDetails},s.a.createElement(ft,{created:t,lastExecutedStatus:n,lastExecuted:c})),s.a.createElement(o.a,{maxWidth:"600px"},s.a.createElement(o.n,{label:O.a.t("Name"),disabled:!0,value:a})),s.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},s.a.createElement(o.A,{label:O.a.t("Job type"),disabled:!0,selected:i},s.a.createElement(o.C,{value:i,label:D[i]}))),s.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},s.a.createElement(o.n,{label:O.a.t("CRON Expression"),disabled:!0,value:d,helpText:Oe(d)})),s.a.createElement(o.a,{marginTop:"24px"},s.a.createElement(oa,null,O.a.t("Back to all jobs")))))},Dt=t(225),It=t.n(Dt);const{bool:Ht,func:wt}=c.a;var Ft=({isPristine:e,setIsPristine:a})=>s.a.createElement(s.a.Fragment,null,s.a.createElement("header",{className:It.a.pageHeader},s.a.createElement(oa,{shouldConfirm:!e,className:It.a.pageHeaderButton,small:!0},O.a.t("Back to all jobs")),s.a.createElement("h2",{className:It.a.pageHeaderTitle},O.a.t("New Job"))),s.a.createElement(o.d,{className:It.a.card},s.a.createElement("header",{className:It.a.cardHeader},s.a.createElement("h3",{className:It.a.cardHeaderTitle},O.a.t("Configuration")),s.a.createElement("a",{href:"https://docs.dhis2.org/en/use/user-guides/dhis-core-version-236/maintaining-the-system/scheduling.html",className:It.a.cardHeaderLink,target:"_blank",rel:"noopener noreferrer"},s.a.createElement("span",{className:It.a.cardHeaderInfo},s.a.createElement(o.l,null)),O.a.t("About job configuration"))),s.a.createElement(rt,{setIsPristine:a})));var kt=()=>{const[e,a]=Object(n.useState)(!0);return s.a.createElement(Ft,{isPristine:e,setIsPristine:a})};var Lt=()=>s.a.createElement(l.b,{history:J},s.a.createElement(l.a,{exact:!0,path:"/",component:Xe}),s.a.createElement(l.a,{path:"/edit/:id",component:Ot}),s.a.createElement(l.a,{path:"/view/:id",component:Rt}),s.a.createElement(l.a,{path:"/add",component:kt}));var Pt=t(226),Bt=t.n(Pt);const Mt={me:{resource:"me"}},{node:Vt}=c.a;var Gt=({children:e})=>{const{loading:a,error:t,data:r}=Object(i.e)(Mt);if(a)return s.a.createElement(o.p,null,s.a.createElement(o.e,null,s.a.createElement(o.g,null)));if(t)throw t;return(e=>{const{authorities:a}=e;return!!a&&(a.includes("ALL")||a.includes("F_SCHEDULING_ADMIN"))})(r.me)?s.a.createElement(s.a.Fragment,null,e):s.a.createElement("div",{className:Bt.a.noticeBoxWrapper},s.a.createElement(o.x,{error:!0,title:O.a.t("Not authorized")},O.a.t("You don't have access to the Job Scheduler. Contact a system administrator to request access.")))},Ut=t(227),zt=t.n(Ut);const{node:Wt}=c.a;var Yt=({children:e})=>s.a.createElement("div",{className:zt.a.wrapper},e),qt=(t(228),t(229));O.a.addResources("en","default",qt);O.a;var Xt=()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(o.h,{spacers:!0,colors:!0}),s.a.createElement(Yt,null,s.a.createElement(Gt,null,s.a.createElement(E,null,s.a.createElement(Lt,null)))));t.d(a,"default",(function(){return Xt}))}}]);
//# sourceMappingURL=app.0800734f.chunk.js.map