(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{206:function(e,t,a){e.exports={header:"JobList_header__23tFt",headerTitle:"JobList_headerTitle__21D__",headerLink:"JobList_headerLink__2zepi",headerLinkIcon:"JobList_headerLinkIcon__XdfBB",controlContainer:"JobList_controlContainer__3Yzj_",controlRight:"JobList_controlRight__38lfB"}},207:function(e,t,a){e.exports={list:"FormErrorBox_list__3BejY"}},208:function(e,t,a){e.exports={headerTitle:"ParameterFields_headerTitle__IBF76"}},209:function(e,t,a){e.exports={formButtonContainer:"JobAddForm_formButtonContainer__1MLSp",saveButton:"JobAddForm_saveButton__RfxZ9"}},210:function(e,t,a){e.exports={formButtonContainer:"JobEditForm_formButtonContainer__2b6Fi",deleteButton:"JobEditForm_deleteButton__VQxBE",saveButton:"JobEditForm_saveButton__278Ab"}},215:function(e,t,a){e.exports={wrapper:"JobDetails_wrapper__1-YkO",title:"JobDetails_title__1Cht7",details:"JobDetails_details__2HITJ"}},216:function(e,t,a){e.exports={pageHeader:"JobEdit_pageHeader__3Fywp",pageHeaderButton:"JobEdit_pageHeaderButton__29yjJ",pageHeaderTitle:"JobEdit_pageHeaderTitle__jZrIG",card:"JobEdit_card__2QqEg",cardHeader:"JobEdit_cardHeader__Mv_cj",cardHeaderTitle:"JobEdit_cardHeaderTitle__29Y64",cardHeaderInfo:"JobEdit_cardHeaderInfo__3VWZt",cardHeaderLink:"JobEdit_cardHeaderLink__2frj7",jobDetails:"JobEdit_jobDetails__194v-"}},217:function(e,t,a){e.exports={pageHeader:"JobAdd_pageHeader__2NZzc",pageHeaderButton:"JobAdd_pageHeaderButton__Xg_R9",pageHeaderTitle:"JobAdd_pageHeaderTitle__1RMl0",card:"JobAdd_card__1HH6H",cardHeader:"JobAdd_cardHeader__1D3sS",cardHeaderTitle:"JobAdd_cardHeaderTitle__2TG9a",cardHeaderInfo:"JobAdd_cardHeaderInfo__vq_Y1",cardHeaderLink:"JobAdd_cardHeaderLink__2CzPt"}},220:function(e,t,a){e.exports={noticeBoxWrapper:"AuthWall_noticeBoxWrapper__1ums5"}},221:function(e,t,a){e.exports={wrapper:"PageWrapper_wrapper__t-CJy"}},222:function(e,t,a){},227:function(e,t,a){"use strict";a.r(t);var r={};a.r(r),a.d(r,"getJobsStore",(function(){return g})),a.d(r,"getJobTypesStore",(function(){return _})),a.d(r,"getParameterOptionsStore",(function(){return f})),a.d(r,"getRefetchJobs",(function(){return y})),a.d(r,"getJobById",(function(){return v})),a.d(r,"getJobType",(function(){return T})),a.d(r,"getJobTypeParameters",(function(){return j})),a.d(r,"getParameterOptions",(function(){return C}));var n=a(1),l=a.n(n),o=a(181),s=a(228),c=a(218),i=a(182),m=a(13);var d=Object(n.createContext)({jobs:{},jobTypes:{},parameterOptions:{},refetchJobs:()=>{throw new Error("Store context needs a valid provider")}});const u={jobs:{resource:"jobConfigurations",params:{fields:"*",paging:!1}}},E={jobTypes:{resource:"jobConfigurations/jobTypes",params:{fields:"*",paging:!1}}},p={skipTableTypes:{resource:"analytics/tableTypes"},validationRuleGroups:{resource:"validationRuleGroups",params:{paging:!1}},pushAnalysis:{resource:"pushAnalysis",params:{paging:!1}},predictors:{resource:"predictors",params:{paging:!1}},predictorGroups:{resource:"predictorGroups",params:{paging:!1}}},{node:b}=i.a;var h=({children:e})=>{const t=Object(m.e)(u),a=Object(m.e)(E),r=Object(m.e)(p);if(t.loading||a.loading||r.loading)return l.a.createElement(o.o,null,l.a.createElement(o.e,null,l.a.createElement(o.g,null)));const n=t.error||a.error||r.error;if(n)throw n;const{jobConfigurations:s}=t.data.jobs,{jobTypes:c}=a.data.jobTypes,{skipTableTypes:i,validationRuleGroups:{validationRuleGroups:b},pushAnalysis:{pushAnalysis:h},predictors:{predictors:g},predictorGroups:{predictorGroups:_}}=r.data,f={skipTableTypes:i,validationRuleGroups:b,pushAnalysis:h,predictors:g,predictorGroups:_};return l.a.createElement(d.Provider,{value:{jobs:s,jobTypes:c,parameterOptions:f,refetchJobs:t.refetch}},e)};const g=e=>e.jobs,_=e=>e.jobTypes,f=e=>e.parameterOptions,y=e=>e.refetchJobs,v=(e,t)=>g(e).find(e=>e.id===t),T=(e,t)=>_(e).find(e=>e.jobType===t),j=(e,t)=>{const a=T(e,t);return"jobParameters"in a?a.jobParameters:[]},C=(e,t)=>f(e)[t];var N=a(8),O=a.n(N),x=a(194);var S=Object(x.a)();var A={DATA_VALUE:O.a.t("Data value"),COMPLETENESS:O.a.t("Completeness"),COMPLETENESS_TARGET:O.a.t("Completeness target"),ORG_UNIT_TARGET:O.a.t("Org unit target"),EVENT:O.a.t("Event"),ENROLLMENT:O.a.t("Enrollment"),VALIDATION_RESULT:O.a.t("Validation result")};var J={ANALYTICS_TABLE:O.a.t("Analytics table"),CONTINUOUS_ANALYTICS_TABLE:O.a.t("Continuous analytics table"),CREDENTIALS_EXPIRY_ALERT:O.a.t("Credentials expiry alert"),DATA_INTEGRITY:O.a.t("Data integrity"),DATA_SET_NOTIFICATION:O.a.t("Dataset notification"),DATA_STATISTICS:O.a.t("Data statistics"),DATA_SYNC:O.a.t("Data synchronization"),EVENT_PROGRAMS_DATA_SYNC:O.a.t("Event programs data sync"),FILE_RESOURCE_CLEANUP:O.a.t("File resource clean up"),META_DATA_SYNC:O.a.t("Metadata synchronization"),MONITORING:O.a.t("Monitoring"),PREDICTOR:O.a.t("Predictor"),PROGRAM_NOTIFICATIONS:O.a.t("Program notifications"),PUSH_ANALYSIS:O.a.t("Push analysis"),REMOVE_EXPIRED_RESERVED_VALUES:O.a.t("Remove expired reserved values"),RESOURCE_TABLE:O.a.t("Resource table"),SEND_SCHEDULED_MESSAGE:O.a.t("Send scheduled message"),TRACKER_PROGRAMS_DATA_SYNC:O.a.t("Tracker programs data sync"),VALIDATION_RESULTS_NOTIFICATION:O.a.t("Validation results notification")};var R={COMPLETED:O.a.t("Completed"),DISABLED:O.a.t("Disabled"),DONE:O.a.t("Done"),FAILED:O.a.t("Failed"),NOT_STARTED:O.a.t("Not started"),RUNNING:O.a.t("Running"),SCHEDULED:O.a.t("Scheduled"),STOPPED:O.a.t("Stopped")};const I={resource:"jobConfigurations",id:({id:e})=>e,type:"update",partial:!0,data:({enabled:e})=>({enabled:e})},{bool:F,string:D}=i.a;var k=({id:e,checked:t})=>{const[a,{loading:s}]=Object(m.d)(I),c=Object(n.useContext)(d),i=r.getRefetchJobs(c),u=!t;return l.a.createElement(o.A,{name:"toggle-job-".concat(e),disabled:s,checked:t,onChange:()=>{a({id:e,enabled:u}).then(()=>i())}})};const{string:L}=i.a;var P=({id:e})=>l.a.createElement(o.p,{dense:!0,onClick:()=>S.push("/edit/".concat(e)),label:O.a.t("Edit")});const H=[{label:O.a.t("Every hour"),value:"0 0 * ? * *"},{label:O.a.t("Every day at midnight"),value:"0 0 1 ? * *"},{label:O.a.t("Every day at 3 am"),value:"0 0 3 ? * *"},{label:O.a.t("Every day at noon"),value:"0 0 12 ? * MON-FRI"},{label:O.a.t("Every week"),value:"0 0 3 ? * MON"}],{func:w}=i.a;var B=({setCron:e,hideModal:t})=>{const[a,r]=Object(n.useState)("");return l.a.createElement(o.q,{open:!0,small:!0,onClose:t},l.a.createElement(o.t,null,O.a.t("Choose a preset time/interval")),l.a.createElement(o.s,null,H.map(e=>l.a.createElement(o.x,Object.assign({},e,{checked:a===e.value,key:e.value,onChange:({value:e})=>r(e)})))),l.a.createElement(o.r,null,l.a.createElement(o.c,{end:!0},l.a.createElement(o.b,{secondary:!0,onClick:t,name:"hide-modal"},O.a.t("Cancel")),l.a.createElement(o.b,{primary:!0,name:"insert-preset",disabled:!a,onClick:()=>{t(),e(a)}},O.a.t("Insert preset")))))};const M={resource:"jobConfigurations",id:({id:e})=>e,type:"delete"},{func:G,string:U}=i.a;var Y=({id:e,hideModal:t,onSuccess:a})=>{const[r]=Object(m.d)(M);return l.a.createElement(o.q,{open:!0,small:!0,onClose:t},l.a.createElement(o.s,null,O.a.t("Are you sure you want to delete this job?")),l.a.createElement(o.r,null,l.a.createElement(o.c,{end:!0},l.a.createElement(o.b,{name:"hide-modal",secondary:!0,onClick:t},O.a.t("Cancel")),l.a.createElement(o.b,{name:"delete-job-".concat(e),destructive:!0,onClick:()=>{r({id:e}).then(()=>{t(),a()})}},O.a.t("Delete")))))};const{func:W}=i.a;var q=({hideModal:e})=>l.a.createElement(o.q,{open:!0,small:!0,onClose:e},l.a.createElement(o.s,null,O.a.t("Are you sure you want to discard this form?")),l.a.createElement(o.r,null,l.a.createElement(o.c,{end:!0},l.a.createElement(o.b,{name:"cancel-discard-form",secondary:!0,onClick:e},O.a.t("Cancel")),l.a.createElement(o.b,{name:"discard-form",destructive:!0,onClick:()=>{e(),S.push("/")}},O.a.t("Discard")))));const{func:V,string:z}=i.a;var X=({id:e,hideModal:t})=>{const a=Object(m.c)(),s={jobs:{resource:"jobConfigurations/".concat(e,"/execute")}},c=Object(n.useContext)(d),i=r.getRefetchJobs(c);return l.a.createElement(o.q,{open:!0,small:!0,onClose:t},l.a.createElement(o.s,null,O.a.t("Are you sure you want to run this job?")),l.a.createElement(o.r,null,l.a.createElement(o.c,{end:!0},l.a.createElement(o.b,{name:"hide-modal",secondary:!0,onClick:t},O.a.t("Cancel")),l.a.createElement(o.b,{name:"run-job-".concat(e),primary:!0,onClick:()=>{a.query(s).then(()=>{t(),i()})}},O.a.t("Run")))))};const{string:K}=i.a;var Z=({id:e})=>{const[t,a]=Object(n.useState)(!1);return l.a.createElement(l.a.Fragment,null,l.a.createElement(o.p,{dense:!0,onClick:()=>{a(!0)},label:O.a.t("Run manually")}),t&&l.a.createElement(X,{id:e,hideModal:()=>a(!1)}))};const{string:Q}=i.a;var $=({id:e})=>{const[t,a]=Object(n.useState)(!1),s=Object(n.useContext)(d),c=r.getRefetchJobs(s);return l.a.createElement(l.a.Fragment,null,l.a.createElement(o.p,{dense:!0,destructive:!0,onClick:()=>{a(!0)},label:O.a.t("Delete")}),t&&l.a.createElement(Y,{id:e,hideModal:()=>a(!1),onSuccess:c}))};const ee=({id:e,configurable:t})=>l.a.createElement(o.i,{small:!0,component:l.a.createElement(o.k,null,t&&l.a.createElement(P,{id:e}),l.a.createElement(Z,{id:e}),l.a.createElement($,{id:e}))},O.a.t("Actions"));ee.defaultProps={configurable:!1};const{string:te,bool:ae}=i.a;var re=ee;const{string:ne}=i.a;var le=({status:e})=>{switch(e){case"STOPPED":case"DISABLED":return l.a.createElement(o.J,null,R[e]);case"RUNNING":case"NOT_STARTED":case"SCHEDULED":return l.a.createElement(o.J,{neutral:!0},R[e]);case"FAILED":return l.a.createElement(o.J,{negative:!0},R[e]);case"DONE":return l.a.createElement(o.J,{positive:!0},R[e]);default:return null}},oe=a(28),se=a.n(oe);const ce=({nextExecutionTime:e,enabled:t})=>{if(!t||!e)return"-";const a=se()(Date.now()),r=se.a.utc(e);return r.isSameOrBefore(a,"minute")?O.a.t("Not scheduled"):a.to(r)},{bool:ie,string:me}=i.a;ce.propTypes={enabled:ie.isRequired,nextExecutionTime:me};var de=ce,ue=a(204),Ee=a.n(ue);const pe=["MON","TUE","WED","THU","FRI","SAT","SUN"],be=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],he=(e,t,a)=>e>=t&&e<=a,ge=e=>"*"===e,_e=e=>"?"===e,fe=(e,t,a)=>ge(e)||he(e,t,a)||((e,t,a)=>{const r=e.split("-");return!(!r||2!==r.length)&&(he(r[0],t,a)&&he(r[1],t,a)&&r[0]<=r[1])})(e,t,a)||((e,t,a)=>{const r=e.split("/");return!(!r||2!==r.length)&&((ge(r[0])||he(r[0],t,a))&&he(r[1],t,a))})(e,t,a),ye=e=>fe(e,1,12)||(e=>{const t=e.split("-"),[a,r]=t.map(e=>be.indexOf(e));return-1!==a&&void 0===r||-1!==a&&-1!==r&&a<=r})(e),ve=e=>fe(e,1,7)||(e=>{const t=e.split("-"),[a,r]=t.map(e=>pe.indexOf(e));return-1!==a&&void 0===r||-1!==a&&-1!==r&&a<=r})(e)||_e(e);var Te=e=>{if(!e)return!1;const t=e.trim().split(" ");return!!(e=>e&&6===e.length)(t)&&(a=t[0],fe(a,0,59)&&(e=>fe(e,0,59))(t[1])&&(e=>fe(e,0,23))(t[2])&&(e=>fe(e,0,31)||_e(e))(t[3])&&ye(t[4])&&ve(t[5]));var a};var je=e=>"string"===typeof e&&e.length>0?Te(e)?void 0:O.a.t("Please enter a valid CRON expression"):O.a.t("A CRON expression is required");var Ce=e=>{const t=O.a.language||"en";return e&&Te(e)?Ee.a.toString(e,{locale:t}):""};const Ne=({cronExpression:e,schedulingType:t,delay:a})=>{switch(t){case"CRON":return Ce(e);case"FIXED_DELAY":return O.a.t("{{ delay }} seconds after last run",{delay:a});default:return"-"}},{string:Oe,number:xe}=i.a;Ne.propTypes={schedulingType:Oe.isRequired,cronExpression:Oe,delay:xe};var Se=Ne;const{shape:Ae,string:Je,bool:Re,number:Ie}=i.a;var Fe=({job:{id:e,displayName:t,jobType:a,cronExpression:r,delay:n,jobStatus:s,nextExecutionTime:c,schedulingType:i,enabled:m,configurable:d}})=>l.a.createElement(o.H,null,l.a.createElement(o.E,null,t),l.a.createElement(o.E,null,J[a]),l.a.createElement(o.E,null,l.a.createElement(Se,{cronExpression:r,delay:n,schedulingType:i})),l.a.createElement(o.E,null,l.a.createElement(de,{nextExecutionTime:c,enabled:m})),l.a.createElement(o.E,null,l.a.createElement(le,{status:s})),l.a.createElement(o.E,null,l.a.createElement(k,{id:e,checked:m})),l.a.createElement(o.E,null,l.a.createElement(re,{id:e,configurable:d})));const{object:De,arrayOf:ke}=i.a;var Le=({jobs:e})=>l.a.createElement(o.C,null,l.a.createElement(o.G,null,l.a.createElement(o.I,null,l.a.createElement(o.F,null,O.a.t("Job name")),l.a.createElement(o.F,null,O.a.t("Type")),l.a.createElement(o.F,null,O.a.t("Schedule")),l.a.createElement(o.F,null,O.a.t("Next run")),l.a.createElement(o.F,null,O.a.t("Status")),l.a.createElement(o.F,null,O.a.t("On/off")),l.a.createElement(o.F,null))),l.a.createElement(o.D,null,0===e.length?l.a.createElement(o.H,null,l.a.createElement(o.E,null,O.a.t("No jobs to display"))):e.map(e=>l.a.createElement(Fe,{key:e.id,job:e})))),Pe=a(206),He=a.n(Pe);const{bool:we,object:Be,string:Me,arrayOf:Ge,func:Ue}=i.a;var Ye=({jobs:e,showSystemJobs:t,setShowSystemJobs:a,jobFilter:r,setJobFilter:n})=>l.a.createElement(l.a.Fragment,null,l.a.createElement("header",{className:He.a.header},l.a.createElement("h1",{className:He.a.headerTitle},O.a.t("Scheduled jobs")),l.a.createElement("a",{href:"https://docs.dhis2.org/master/en/user/html/dataAdmin_scheduling.html#dataAdmin_scheduling_config",className:He.a.headerLink,target:"_blank",rel:"noopener noreferrer"},l.a.createElement("span",{className:He.a.headerLinkIcon},l.a.createElement(o.l,null)),O.a.t("About job configuration"))),l.a.createElement(o.d,null,l.a.createElement("div",{className:He.a.controlContainer},l.a.createElement(o.m,{dataTest:"job-filter-input",placeholder:O.a.t("Filter jobs"),onChange:({value:e})=>{n(e)},value:r}),l.a.createElement("div",{className:He.a.controlRight},l.a.createElement(o.f,{dataTest:"job-toggle-checkbox",checked:t,label:O.a.t("Include system jobs in list"),onChange:({checked:e})=>{a(e)}}),l.a.createElement(o.b,{dataTest:"new-job-button",onClick:()=>{S.push("/add")}},O.a.t("New job")))),l.a.createElement(Le,{jobs:e})));var We=()=>{const[e,t]=Object(n.useState)(!1),[a,o]=Object(n.useState)(""),s=Object(n.useContext)(d),c=((e,t)=>e.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())))(r.getJobsStore(s),a),i=e?c:(e=>e.filter(e=>e.configurable))(c);return l.a.createElement(Ye,{jobs:i,showSystemJobs:e,setShowSystemJobs:t,jobFilter:a,setJobFilter:o})};const qe=({setCron:e,small:t})=>{const[a,r]=Object(n.useState)(!1);return l.a.createElement(l.a.Fragment,null,l.a.createElement(o.b,{onClick:()=>r(!0),small:t},O.a.t("Choose from preset times")),a&&l.a.createElement(B,{hideModal:()=>r(!1),setCron:e}))};qe.defaultProps={small:!1};const{func:Ve,bool:ze}=i.a;var Xe=qe;const{string:Ke,func:Ze}=i.a;var Qe=({id:e,onSuccess:t})=>{const[a,r]=Object(n.useState)(!1);return l.a.createElement(l.a.Fragment,null,l.a.createElement(o.b,{destructive:!0,onClick:()=>r(!0)},O.a.t("Delete job")),a&&l.a.createElement(Y,{id:e,hideModal:()=>r(!1),onSuccess:t}))};const $e=({shouldConfirm:e,children:t,small:a,className:r})=>{const[s,c]=Object(n.useState)(!1),i=e?()=>c(!0):()=>S.push("/");return l.a.createElement(l.a.Fragment,null,l.a.createElement(o.b,{onClick:i,small:a,className:r},t),s&&l.a.createElement(q,{hideModal:()=>c(!1)}))};$e.defaultProps={className:"",shouldConfirm:!1,small:!1};const{string:et,bool:tt}=i.a;var at=$e;const{FORM_ERROR:rt}=o.j;var nt=e=>{const{details:{response:t}}=e,a={},r=[];return t.errorReports&&t.errorReports.length&&t.errorReports.forEach(e=>{e.errorProperty?a[e.errorProperty]=e.message:r.push(e.message)}),r.length>0&&(a[rt]=r),a};const lt={resource:"jobConfigurations",type:"create",data:({job:e})=>e};var ot=()=>{const{refetchJobs:e}=Object(n.useContext)(d),t=Object(m.c)();return[a=>t.mutate(lt,{variables:{job:a}}).then(()=>{S.push("/"),e()}).catch(e=>{if("access"===e.type)return nt(e);throw e})]};const st={resource:"jobConfigurations",type:"update",id:({id:e})=>e,data:({job:e})=>e};var ct=({id:e})=>{const{refetchJobs:t}=Object(n.useContext)(d),a=Object(m.c)();return[r=>a.mutate(st,{variables:{job:r,id:e}}).then(()=>{S.push("/"),t()}).catch(e=>{if("access"===e.type)return nt(e);throw e})]},it=a(207),mt=a.n(it);const{array:dt}=i.a;var ut=({submitError:e})=>e.length>0?l.a.createElement(o.w,{error:!0,title:O.a.t("Something went wrong whilst creating your job")},l.a.createElement("ul",{className:mt.a.list},e.map(e=>l.a.createElement("li",{key:e},e)))):null;const{Field:Et}=o.y,pt=Object(o.K)(o.O,o.M);var bt=()=>l.a.createElement(Et,{name:"name",component:o.n,validate:pt,label:O.a.t("Name"),type:"text",required:!0});const{Field:ht}=o.y,gt=Object(o.K)(o.O,o.M);var _t=()=>{const e=Object(n.useContext)(d),t=r.getJobTypesStore(e).map(({jobType:e})=>({value:e,label:J[e]}));return l.a.createElement(ht,{name:"jobType",validate:gt,component:o.z,options:t,label:O.a.t("Job type"),required:!0})};const ft=e=>"number"===typeof e?e.toString():e,{Field:yt}=o.y,{string:vt}=i.a;var Tt=({label:e,name:t,parameterName:a})=>{const s=Object(n.useContext)(d),c=r.getParameterOptions(s,a);if(0===c.length)return l.a.createElement(o.u,{disabled:!0,helpText:O.a.t("No options available"),label:e});const i=c.map(e=>({value:e,label:A[e]||e}));return l.a.createElement(yt,{name:t,component:o.v,options:i,label:e})};const{Field:jt}=o.y,{string:Ct}=i.a;var Nt=({label:e,name:t,parameterName:a})=>{const s=Object(n.useContext)(d),c=r.getParameterOptions(s,a);if(0===c.length)return l.a.createElement(o.u,{disabled:!0,helpText:O.a.t("No options available"),label:e});const i=c.map(({id:e,displayName:t})=>({value:e,label:t}));return l.a.createElement(jt,{name:t,component:o.v,options:i,label:e})},Ot=a(208),xt=a.n(Ot);const{Field:St}=o.y,{string:At}=i.a;var Jt=({jobType:e})=>{const t=Object(n.useContext)(d),a=r.getJobTypeParameters(t,e);if(0===a.length)return null;const s=a.map(({fieldName:e,name:t,klass:a})=>{const r={label:e,name:"".concat("jobParameters",".").concat(t)};let n=null;if("skipTableTypes"===t)return l.a.createElement(o.a,{marginTop:"16px",key:t},l.a.createElement(Tt,Object.assign({},r,{parameterName:t})));switch(a){case"java.lang.String":n=l.a.createElement(St,Object.assign({},r,{component:o.n,type:"text"}));break;case"java.lang.Boolean":n=l.a.createElement(St,Object.assign({},r,{component:o.B,type:"checkbox"}));break;case"java.lang.Integer":n=l.a.createElement(St,Object.assign({},r,{component:o.n,format:ft,type:"number"}));break;case"java.util.List":n=l.a.createElement(Nt,Object.assign({},r,{parameterName:t}))}return l.a.createElement(o.a,{marginTop:"16px",key:t},n)});return l.a.createElement(l.a.Fragment,null,l.a.createElement("header",null,l.a.createElement("h4",{className:xt.a.headerTitle},O.a.t("Parameters"))),s)};const{Field:Rt,useFormState:It,useForm:Ft}=o.y,Dt=je;var kt=()=>{const e=Ft(),{values:t}=It({subscription:{values:!0}}),a=t.cronExpression,r=Ce(a);return l.a.createElement(l.a.Fragment,null,l.a.createElement(Rt,{component:o.n,name:"cronExpression",validate:Dt,label:O.a.t("CRON Expression"),type:"text",helpText:r,required:!0}),l.a.createElement(o.a,{marginTop:"8px"},l.a.createElement(Xe,{setCron:t=>e.change("cronExpression",t),small:!0})))};const{Field:Lt}=o.y,Pt=Object(o.K)(o.N,o.M,Object(o.L)(1,86400));var Ht=()=>l.a.createElement(Lt,{component:o.n,name:"delay",validate:Pt,label:O.a.t("Delay"),type:"number",format:ft,helpText:O.a.t("Delay in seconds ({{ lowerbound }} - {{ upperbound }})",{lowerbound:1,upperbound:86400}),required:!0});const{string:wt}=i.a;var Bt=({jobType:e})=>{const t=Object(n.useContext)(d);switch(r.getJobType(t,e).schedulingType){case"CRON":return l.a.createElement(kt,null);case"FIXED_DELAY":return l.a.createElement(Ht,null);default:return null}};const Mt="jobType";var Gt=a(209),Ut=a.n(Gt);const{useForm:Yt}=o.y,Wt=({handleSubmit:e,pristine:t,submitting:a,submitError:r,hasSubmitErrors:s,values:c,setIsPristine:i})=>{const{subscribe:m}=Yt();Object(n.useEffect)(()=>m(({pristine:e})=>i(e),{pristine:!0}));const d=c[Mt],u=a?l.a.createElement(o.g,{small:!0}):null;return l.a.createElement("form",{onSubmit:e},l.a.createElement(o.a,{maxWidth:"600px"},l.a.createElement(bt,null)),l.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},l.a.createElement(_t,null)),d&&l.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},l.a.createElement(Bt,{jobType:d})),d&&l.a.createElement(o.a,{marginTop:"32px",maxWidth:"400px"},l.a.createElement(Jt,{jobType:d})),s&&l.a.createElement(o.a,{marginTop:"32px",maxWidth:"600px"},l.a.createElement(ut,{submitError:r})),l.a.createElement("div",{className:Ut.a.formButtonContainer},l.a.createElement(o.b,{primary:!0,type:"submit",disabled:t||a,icon:u,className:Ut.a.saveButton},O.a.t("Save")),l.a.createElement(at,{shouldConfirm:!t},O.a.t("Cancel"))))},{func:qt,bool:Vt,object:zt,array:Xt}=i.a;Wt.defaultProps={submitError:[]};var Kt=Wt;const{Form:Zt}=o.y,{func:Qt}=i.a;var $t=({setIsPristine:e})=>{const[t]=ot();return l.a.createElement(Zt,{onSubmit:t,component:Kt,setIsPristine:e,destroyOnUnregister:!0})},ea=a(210),ta=a.n(ea);const{useForm:aa}=o.y,ra=({id:e,refetchJobs:t,handleSubmit:a,pristine:r,submitting:s,submitError:c,hasSubmitErrors:i,values:m,setIsPristine:d})=>{const{subscribe:u}=aa();Object(n.useEffect)(()=>u(({pristine:e})=>d(e),{pristine:!0}));const E=m[Mt],p=s?l.a.createElement(o.g,{small:!0}):null;return l.a.createElement("form",{onSubmit:a},l.a.createElement(o.a,{maxWidth:"600px"},l.a.createElement(bt,null)),l.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},l.a.createElement(_t,null)),E&&l.a.createElement(o.a,{marginTop:"16px",maxWidth:"400px"},l.a.createElement(Bt,{jobType:E})),E&&l.a.createElement(o.a,{marginTop:"32px",maxWidth:"400px"},l.a.createElement(Jt,{jobType:E})),i&&l.a.createElement(o.a,{marginTop:"32px",maxWidth:"600px"},l.a.createElement(ut,{submitError:c})),l.a.createElement("div",{className:ta.a.formButtonContainer},l.a.createElement(o.b,{primary:!0,type:"submit",disabled:r||s,icon:p,className:ta.a.saveButton},O.a.t("Save")),l.a.createElement(at,{shouldConfirm:!r},O.a.t("Cancel")),l.a.createElement("span",{className:ta.a.deleteButton},l.a.createElement(Qe,{id:e,onSuccess:()=>{S.push("/"),t()}}))))},{func:na,bool:la,object:oa,array:sa,string:ca}=i.a;ra.defaultProps={submitError:[]};var ia=ra;const{Form:ma}=o.y,da=["cronExpression","delay","jobParameters","jobType","name","schedulingType"],{func:ua}=i.a;var Ea=({setIsPristine:e})=>{const{id:t}=Object(s.b)(),[a]=ct({id:t}),o=Object(n.useContext)(d),c=r.getRefetchJobs(o),i=r.getJobById(o,t),m=da.reduce((e,t)=>(e[t]=i[t],e),{});return l.a.createElement(ma,{onSubmit:a,component:ia,setIsPristine:e,initialValues:m,id:t,refetchJobs:c,destroyOnUnregister:!0})},pa=a(215),ba=a.n(pa);const{string:ha}=i.a;var ga=({created:e,lastExecutedStatus:t,lastExecuted:a})=>{const r=Date.now(),n=se()(e).from(r),o=R[t],s=a?se()(a).from(r):"";return l.a.createElement("div",{className:ba.a.wrapper},l.a.createElement("h4",{className:ba.a.title},O.a.t("Job details")),l.a.createElement("div",{className:ba.a.details},l.a.createElement("div",null,O.a.t("Created {{ createdFromNow }}.",{createdFromNow:n})),s&&l.a.createElement("div",null,O.a.t("Last run {{ lastRunFromNow }}.",{lastRunFromNow:s})),o&&l.a.createElement("div",null,O.a.t("Last run status: {{ translatedStatus }}.",{translatedStatus:o,nsSeparator:">"}))))},_a=a(216),fa=a.n(_a);const{bool:ya,func:va,string:Ta}=i.a;var ja=({isPristine:e,setIsPristine:t,name:a,created:r,lastExecutedStatus:n,lastExecuted:s})=>l.a.createElement(l.a.Fragment,null,l.a.createElement("header",{className:fa.a.pageHeader},l.a.createElement(at,{shouldConfirm:!e,className:fa.a.pageHeaderButton,small:!0},O.a.t("Back to all jobs")),l.a.createElement("h2",{className:fa.a.pageHeaderTitle},O.a.t("Job: {{ name }}",{name:a,nsSeparator:">"}))),l.a.createElement(o.d,{className:fa.a.card},l.a.createElement("header",{className:fa.a.cardHeader},l.a.createElement("h3",{className:fa.a.cardHeaderTitle},O.a.t("Configuration")),l.a.createElement("a",{href:"https://docs.dhis2.org/master/en/user/html/dataAdmin_scheduling.html#dataAdmin_scheduling_config",className:fa.a.cardHeaderLink,target:"_blank",rel:"noopener noreferrer"},l.a.createElement("span",{className:fa.a.cardHeaderInfo},l.a.createElement(o.l,null)),O.a.t("About job configuration"))),l.a.createElement("div",{className:fa.a.jobDetails},l.a.createElement(ga,{created:r,lastExecutedStatus:n,lastExecuted:s})),l.a.createElement(Ea,{setIsPristine:t})));var Ca=()=>{const e=Object(n.useContext)(d),[t,a]=Object(n.useState)(!0),{id:o}=Object(s.b)(),c=r.getJobById(e,o);return l.a.createElement(ja,{isPristine:t,setIsPristine:a,name:c.name,created:c.created,lastExecutedStatus:c.lastExecutedStatus,lastExecuted:c.lastExecuted})},Na=a(217),Oa=a.n(Na);const{bool:xa,func:Sa}=i.a;var Aa=({isPristine:e,setIsPristine:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement("header",{className:Oa.a.pageHeader},l.a.createElement(at,{shouldConfirm:!e,className:Oa.a.pageHeaderButton,small:!0},O.a.t("Back to all jobs")),l.a.createElement("h2",{className:Oa.a.pageHeaderTitle},O.a.t("New Job"))),l.a.createElement(o.d,{className:Oa.a.card},l.a.createElement("header",{className:Oa.a.cardHeader},l.a.createElement("h3",{className:Oa.a.cardHeaderTitle},O.a.t("Configuration")),l.a.createElement("a",{href:"https://docs.dhis2.org/master/en/user/html/dataAdmin_scheduling.html#dataAdmin_scheduling_config",className:Oa.a.cardHeaderLink,target:"_blank",rel:"noopener noreferrer"},l.a.createElement("span",{className:Oa.a.cardHeaderInfo},l.a.createElement(o.l,null)),O.a.t("About job configuration"))),l.a.createElement($t,{setIsPristine:t})));var Ja=()=>{const[e,t]=Object(n.useState)(!0);return l.a.createElement(Aa,{isPristine:e,setIsPristine:t})};var Ra=()=>l.a.createElement(c.a,{history:S},l.a.createElement(s.a,{exact:!0,path:"/",component:We}),l.a.createElement(s.a,{path:"/edit/:id",component:Ca}),l.a.createElement(s.a,{path:"/add",component:Ja}));var Ia=a(220),Fa=a.n(Ia);const Da={me:{resource:"me"}},{node:ka}=i.a;var La=({children:e})=>{const{loading:t,error:a,data:r}=Object(m.e)(Da);if(t)return l.a.createElement(o.o,null,l.a.createElement(o.e,null,l.a.createElement(o.g,null)));if(a)throw a;return(e=>{const{authorities:t}=e;return!!t&&(t.includes("ALL")||t.includes("F_SCHEDULING_ADMIN"))})(r.me)?l.a.createElement(l.a.Fragment,null,e):l.a.createElement("div",{className:Fa.a.noticeBoxWrapper},l.a.createElement(o.w,{error:!0,title:O.a.t("Not authorized")},O.a.t("You don't have access to the Job Scheduler. Contact a system administrator to request access.")))},Pa=a(221),Ha=a.n(Pa);const{node:wa}=i.a;var Ba=({children:e})=>l.a.createElement("div",{className:Ha.a.wrapper},e);a(222);var Ma=()=>l.a.createElement(l.a.Fragment,null,l.a.createElement(o.h,{spacers:!0,colors:!0}),l.a.createElement(Ba,null,l.a.createElement(La,null,l.a.createElement(h,null,l.a.createElement(Ra,null)))));a.d(t,"default",(function(){return Ma}))}}]);
//# sourceMappingURL=app.c6e9e0a6.chunk.js.map